<div drawing-grid class="editor" ng-class="{ 'edit-grid': page === display.editGrid, 'blur-grid': page !== display.editGrid }">
	<div class="row" ng-repeat="row in page.rows.all">
		<div class="square-menu">
			<button ng-click="addCell(row)">+</button>
		</div>
		<div class="square-menu-actions guide-line">
			<div class="grid-guides">
				<div class="row" ng-repeat="i in display.guideRows">
					<div class="one cell height-one" ng-repeat="i in display.guideCols"></div>
				</div>
			</div>
			<grid-row index="row.index">
				<grid-cell ng-repeat="cell in row.cells.all" class="media cell"
						   grid-resizable grid-draggable w="cell.width" h="cell.height" class-name="cell.className"
						   on-index-change="row.setIndex(cell, cell.index)" on-row-change="setRow(cell, cell.row)" index="cell.index" row="cell.row" ng-mousedown="editGrid(cell.media.source, $event)">
					<div ng-if="!cell.media.type">
						<ul class="menu-items">
							<li ng-click="setType(cell, 'text')"><i class="text"></i>Ajouter du texte</li>
							<li><media-select ng-model="cell.media.source" ng-change="setType(cell, 'image')" class="image" label="Ajouter une image" file-format="'img'"></media-select></li>
							<li><media-select ng-model="cell.media.source" ng-change="setType(row, 'sound')" class="sound" file-format="'audio'" label="Ajouter du son"></media-select></li>
							<li ng-click="display.selectVideoContent = true"><i class="video"></i>Ajouter une vidéo</li>
							<li ng-click="display.selectSniplet = true;"><i class="sniplet"></i>Ajouter un sniplet (navigation, documents à télécharger...)</li>
							<li ng-click="setType(cell, 'grid')"><i class="grid"></i>Ajouter une grille (les grilles permettent de créer des lignes à l'intérieur d'une cellule)</li>
						</ul>
						<lightbox show="display.selectVideoContent" on-close="display.selectVideoContent = false">
							<h2>Insérer une vidéo</h2>
							<p class="info">
								Au préalable, votre vidéo doit être enregistrée sur une plateforme de partage (Youtube, Vimeo, etc.).
								Pour l'insérer ici, copiez le le lien de partage "embed" et collez-le ci-dessous.
							</p>
							<div class="row">
								<textarea ng-model="cell.media.source"></textarea>
							</div>
							<div class="row">
								<button class="right-magnet" ng-click="setType(cell, 'video')">Ajouter</button>
								<input type="button" class="cancel right-magnet" i18n-value="cancel" ng-click="display.selectVideoContent = false;" />
							</div>
						</lightbox>
						<lightbox show="display.selectSniplet" on-close="display.selectSniplet = false">
							<div ng-if="display.snipletStep === 1">
								<h2>Choisir un contenu dynamique</h2>
								<ul class="thought-out-actions">
									<li ng-repeat="sniplet in sniplets" ng-click="selectSnipletSource(sniplet.template, sniplet.application)">
										<h2>[[sniplet.sniplet.title]]</h2>
										<p>[[sniplet.sniplet.description]]</p>
									</li>
								</ul>
							</div>
							<div ng-if="display.snipletStep === 2">
								<sniplet-source application="[[sniplet.application]]" template="[[sniplet.template]]" ng-model="sniplet.source" ng-change="addSniplet(cell)"></sniplet-source>
							</div>
						</lightbox>
					</div>
					<div ng-if="cell.media.type === 'text' || cell.media.type === 'video'" class="text-wrapper">
						<text-editor ng-model="cell.media.source"></text-editor>
						<div ng-if="cell.media.type === 'video'" class="absolute"></div>
					</div>
					<div ng-if="cell.media.type === 'image'" class="image-container">
						<image-select ng-model="cell.media.source"></image-select>
					</div>
					<div ng-if="cell.media.type === 'sound'" class="text-wrapper">
						<sound-select ng-model="cell.media.source"></sound-select>
					</div>
					<div ng-if="cell.media.type === 'sniplet'">
						<sniplet template="[[cell.media.source.template]]" application="[[cell.media.source.application]]" source="cell.media.source.source"></sniplet>
					</div>
					<div ng-if="cell.media.type === 'grid'" class="grid-wrapper">
						<div class="nested-grid" ng-init="page = cell.media.source">
							<container template="grid" ng-mousedown="editGrid(page, $event)"></container>
						</div>
					</div>
					<i class="close" ng-click="removeCell(row, cell)"></i>
					<div ng-if="cell.media.type === 'text' || cell.media.type === 'sound'">
						<color-select ng-model="cell.className[0]"></color-select>
					</div>
				</grid-cell>
				<div class="row" style="min-height: 0"></div>
			</grid-row>
		</div>
	</div>
	<div class="row">
		<div class="square-menu"></div>
		<div class="square-menu-actions">
			<button ng-click="page.addRow()" class="grid-add-row">
				Ajouter une ligne
			</button>
		</div>
	</div>
</div>