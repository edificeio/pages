<div drawing-grid class="editor">
	<div class="row" ng-repeat="row in page.rows.all">
		<div class="square-menu" ng-class="{opened: display.openRadialMenu}">
			<button ng-show="!row.openSquareMenu" ng-click="row.openSquareMenu = true" tooltip="Ajouter une cellule">+</button>
			<ul class="menu-items" ng-show="row.openSquareMenu">
				<li tooltip="Ajouter du texte"><i class="text" ng-click="addCell(row, 'text')"></i></li>
				<li tooltip="Ajouter une image"><media-select ng-model="newCell.media.source" ng-change="addCell(row, 'image')" class="image" file-format="'img'"></media-select></li>
				<li tooltip="Ajouter du son"><media-select ng-model="newCell.media.source" ng-change="addCell(row, 'sound')" class="sound" file-format="'audio'"></media-select></li>
				<li tooltip="Ajouter une vidéo"><i class="video" ng-click="display.selectVideoContent = true"></i></li>
				<li tooltip="Ajouter un sniplet<br />(navigation, trombinoscope...)"><i class="sniplet" ng-click="display.selectSniplet = true;"></i></li>
				<li tooltip="Ajouter une grille<br />(les grilles permettent de créer des lignes à l'intérieur d'une cellule)">
					<i class="grid" ng-click="addCell(row, 'grid')"></i>
				</li>
			</ul>
			<lightbox show="display.selectVideoContent" on-close="display.selectVideoContent = false">
				<h2>Insérer une vidéo</h2>
				<p class="info">
					Au préalable, votre vidéo doit être enregistrée sur une plateforme de partage (Youtube, Vimeo, etc.).
					Pour l'insérer ici, copiez le le lien de partage "embed" et collez-le ci-dessous.
				</p>
				<div class="row">
					<textarea ng-model="newCell.media.source"></textarea>
				</div>
				<div class="row">
					<button class="right-magnet" ng-click="addCell(row, 'video')">Ajouter</button>
					<input type="button" class="cancel right-magnet" i18n-value="cancel" />
				</div>
			</lightbox>
			<lightbox show="display.selectSniplet" on-close="display.selectSniplet = false">
				<div ng-if="display.snipletStep === 1">
					<h2>Choisir un contenu dynamique</h2>
					<div class="row">
						<div class="nine cell">
							<h3>Navigation</h3>
							<p>La navigation permet à vos visiteurs de parcourir les pages de votre site.</p>
						</div>
						<button ng-click="selectSnipletSource('navigation', 'pages')" class="three cell">Ajouter</button>
					</div>
					<div class="row">
						<div class="nine cell">
							<h3>Nouveautés</h3>
							<p>Les nouveautés vous permettent de publier les articles d'un blog sur votre site.</p>
						</div>
						<button ng-click="selectSnipletSource('articles', 'blog')" class="three cell">Ajouter</button>
					</div>
					<div class="row">
						<div class="nine cell">
							<h3>Documents</h3>
							<p>Cet outil propose des documents à télécharger à vos visiteurs.</p>
						</div>
						<button ng-click="selectSnipletSource('documents', 'workspace')" class="three cell">Ajouter</button>
					</div>
					<div class="row">
						<div class="nine cell">
							<h3>Trombinoscope</h3>
							<p>Le trombinoscope affiche toutes les photos des utilisateurs de votre site.</p>
						</div>
						<button ng-click="selectSnipletSource('trombi', 'pages')" class="three cell">Ajouter</button>
					</div>
				</div>
				<div ng-if="display.snipletStep === 2">
					<sniplet-source application="[[sniplet.application]]" template="[[sniplet.template]]" ng-model="sniplet.source" ng-change="addSniplet(row)"></sniplet-source>
				</div>
			</lightbox>
		</div>
		<div class="square-menu-actions guide-line">
			<div class="grid-guides">
				<div class="row" ng-repeat="i in display.guideRows">
					<div class="one cell height-one" ng-repeat="i in display.guideCols"></div>
				</div>
			</div>
			<grid-row index="row.index">
				<grid-cell ng-repeat="cell in row.cells.all" class="media cell"
						   grid-resizable grid-draggable w="cell.width" h="cell.height" class-name="cell.className"
						   on-index-change="row.setIndex(cell, cell.index)" on-row-change="setRow(cell, cell.row)" index="cell.index" row="cell.row">
					<div ng-if="cell.media.type === 'text' || cell.media.type === 'video'" class="text-wrapper">
						<text-editor ng-model="cell.media.source"></text-editor>
						<div ng-if="cell.media.type === 'video'" class="absolute"></div>
					</div>
					<div ng-if="cell.media.type === 'image'" class="image-container">
						<image-select ng-model="cell.media.source"></image-select>
					</div>
					<div ng-if="cell.media.type === 'sound'" class="text-wrapper">
						<sound-select ng-model="cell.media.source"></sound-select>
					</div>
					<div ng-if="cell.media.type === 'sniplet'">
						<sniplet template="[[cell.media.source.template]]" application="[[cell.media.source.application]]" source="cell.media.source.source"></sniplet>
					</div>
					<div ng-if="cell.media.type === 'grid'" class="grid-wrapper">
						<div class="media-container" ng-init="page = cell.media.source">
							<div ng-if="display.editGrid === page" class="nested-grid">
								<container template="grid"></container>
							</div>
							<div ng-if="display.editGrid !== page" ng-click="editGrid(page, $event)" class="nested-grid">
								<container template="grid-view"></container>
							</div>

						</div>
					</div>
					<i class="close" ng-click="removeCell(row, cell)"></i>
					<div ng-if="cell.media.type === 'text' || cell.media.type === 'sound'">
						<color-select ng-model="cell.className[0]"></color-select>
					</div>
				</grid-cell>
				<div class="row" style="min-height: 0"></div>
			</grid-row>
		</div>
	</div>
	<div class="row">
		<div class="square-menu"></div>
		<div class="square-menu-actions">
			<button ng-click="page.addRow()" class="grid-add-row">
				Ajouter une ligne
			</button>
		</div>
	</div>
</div>