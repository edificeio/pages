<div class="row">

	<app-title>
		<h1 class="cell"><a data-reload><i18n>pages.app.title</i18n></a></h1>
    </app-title>

	<div class="cell right-magnet zero-mobile" workflow="pages.create">
		<button class="right-magnet" ng-click="display.createNewSite = true">
			<i18n>website.create</i18n>
		</button>
		<plus workflow="pages.createPublic">
			<button ng-click="display.createNewSite = true; website.visibility = 'PUBLIC';" workflow="pages.createPublic">
				<i18n>website.addForm.public.title</i18n>
			</button>
		</plus>

		<lightbox show="display.createNewSite" on-close="cancelSiteCreation()">
			<h2><i18n>website.addForm.title</i18n></h2>
			<div class="row">
				<div class="row">
					<label class="three cell"><i18n>title</i18n></label>
					<input class="nine cell" type="text" ng-model="website.title" />
				</div>
			</div>
			<div class="row">
				<button class="right-magnet" ng-click="createSite()"><i18n>create</i18n></button>
				<button type="button" class="cancel right-magnet" ng-click="cancelSiteCreation()"><i18n>cancel</i18n></button>
			</div>
		</lightbox>
	</div>
</div>

<div class="row rigid-grid">
	<div class="two cell">
		<filters>
			<li ng-class="{ selected: display.mineOnly }">
				<label ng-click="websites.deselectAll()">
					<i class="mine type" tooltip="filters.mine"></i>
					<input type="checkbox" ng-model="display.mineOnly" />
				</label>
			</li>
			<li ng-class="{ selected: display.publicSites }">
				<label ng-click="websites.deselectAll()">
					<i class="public type" tooltip="filters.publicSites"></i>
					<input type="checkbox" ng-model="display.publicSites" />
				</label>
			</li>
		</filters>
	</div>
	<div class="margin-two">
		<input type="search" class="twelve cell" i18n-placeholder="search" ng-model="display.search" />
	</div>
</div>

<nav class="illustrated-links">
	<ul>
		<li ng-repeat="website in websites.all | filter:searchMatch">
			<div class="illustration zero-mobile" ng-click="viewSite(website)">
				<img ng-src="[[website.icon]]?thumbnail=150x150" alt="thumbnail" ng-if="website.icon" />
				<img skin-src="/img/illustrations/pages-default.png" alt="thumbnail" ng-if="!website.icon" />
			</div>
			<div class="content">
				<div class="row">
					<resource-right name="update" resource="website">
						<label class="cell zero-mobile"><input type="checkbox" ng-model="website.selected" /><span></span></label>
					</resource-right>

					<h2 ng-click="viewSite(website)" class="eight cell" ng-if="website.visibility !== 'PUBLIC'">
						[[website.title]]
					</h2>
					<h2 class="eight cell" ng-if="website.visibility === 'PUBLIC'">
						<i class="public"></i><a target="_blank" ng-href="/pages/p/website#/website/[[website._id]]">[[website.title]]</a>
					</h2>
				</div>
				<div class="row">
					<em><i18n>pages.by</i18n> [[website.owner.displayName]]</em> - <a ng-href="[[website.url()]]" target="_blank"><strong>[[website.url()]]</strong></a>
					<p>[[website.description]]</p>
				</div>
			</div>
		</li>
	</ul>
</nav>

<div class="toggle-buttons" ng-class="{ hide: websites.selection().length < 1 }">
	<div class="row toggle">

		<resource-right name="update" resource="websites.selection()">
			<button ng-click="editWebsiteProperties()" ng-if="websites.selection().length === 1"><i18n>properties</i18n></button>
		</resource-right>
		<resource-right name="update" resource="websites.selection()">
			<button ng-click="editWebsitePages()" ng-if="websites.selection().length === 1"><i18n>website.pages</i18n></button>
		</resource-right>
		<resource-right name="share" resource="websites.selection()" class="cell">
			<button class="cell" ng-click="display.showSharePanel = true"><i18n>share</i18n></button>
		</resource-right>
		<button class="cell" ng-click="openPublish()" user-role="ADMIN_LOCAL" ng-if="websites.selection().length === 1"><i18n>pages.publish</i18n></button>
		<div ng-if="display.showSharePanel">
			<lightbox show="display.showSharePanel" on-close="display.showSharePanel = false">
				<share-panel app-prefix="'pages'" resources="websites.selection()"></share-panel>
			</lightbox>
		</div>
		<lightbox show="display.showPublish" on-close="display.showPublish = false">
			<container template="publish"></container>
		</lightbox>
		<resource-right name="remove" resource="websites.selection()">
			<button ng-click="openRemoveConfirm(website)"><i18n>remove</i18n></button>
		</resource-right>
	</div>
</div>

<lightbox show="display.showConfirmRemove" on-close="display.showConfirmRemove = false">
	<h2><i18n>remove</i18n></h2>

	<p><i18n>remove.confirm</i18n></p>

	<div class="row">
		<button class="right-magnet" ng-click="removeWebsites()">
			<i18n>remove</i18n>
		</button>
		<input class="cancel right-magnet" i18n-value="cancel" type="button" ng-click="display.showConfirmRemove = false" />

	</div>
</lightbox>
